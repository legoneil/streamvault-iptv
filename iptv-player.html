<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamVault - Advanced IPTV Player</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=IBM+Plex+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131825;
            --bg-tertiary: #1a1f2e;
            --accent-primary: #00f0ff;
            --accent-secondary: #ff00aa;
            --accent-gradient: linear-gradient(135deg, #00f0ff 0%, #0080ff 50%, #ff00aa 100%);
            --text-primary: #ffffff;
            --text-secondary: #8b92a8;
            --text-muted: #4a5568;
            --border-color: #2a3142;
            --shadow-glow: 0 0 20px rgba(0, 240, 255, 0.3);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 240, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 0, 170, 0.1) 0%, transparent 50%);
            z-index: 0;
            animation: pulse 8s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }

        /* Welcome Screen */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            background: var(--bg-primary);
            transition: var(--transition-smooth);
        }

        .welcome-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .welcome-container {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
        }

        .welcome-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent-gradient);
        }

        .login-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .login-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 30px;
            font-size: 0.9rem;
        }

        /* Saved Playlist Card */
        .saved-playlist {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            transition: var(--transition-smooth);
        }

        .saved-playlist:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }

        .saved-playlist-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }

        .saved-icon {
            width: 50px;
            height: 50px;
            background: var(--accent-gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .saved-info h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .saved-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .saved-actions {
            display: flex;
            gap: 10px;
        }

        .btn-primary, .btn-secondary, .btn-danger {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            font-weight: 500;
        }

        .btn-primary {
            background: var(--accent-gradient);
            color: var(--text-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .btn-danger {
            background: transparent;
            color: #ff4444;
            border: 2px solid #ff4444;
        }

        .btn-danger:hover {
            background: rgba(255, 68, 68, 0.1);
        }

        .divider {
            text-align: center;
            margin: 25px 0;
            color: var(--text-muted);
            font-size: 0.85rem;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background: var(--border-color);
        }

        .divider::before { left: 0; }
        .divider::after { right: 0; }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            background: var(--bg-primary);
            transition: var(--transition-smooth);
        }

        .login-screen.active {
            display: flex;
        }

        .login-container {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-glow);
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--accent-gradient);
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: 'IBM Plex Mono', monospace;
            transition: var(--transition-smooth);
        }

        .back-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .tab-selector {
            display: flex;
            margin-bottom: 25px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 4px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            border-radius: 8px;
            transition: var(--transition-smooth);
        }

        .tab-btn.active {
            background: var(--accent-gradient);
            color: var(--text-primary);
            font-weight: 500;
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
            transition: var(--transition-smooth);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.2);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: var(--accent-gradient);
            border: none;
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: var(--transition-smooth);
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }

        /* Main App Container */
        .app-container {
            position: relative;
            z-index: 1;
            display: none;
            height: 100vh;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        .app-container.active {
            display: flex;
            opacity: 1;
        }

        /* Header */
        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(19, 24, 37, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 100;
        }

        .header-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .header-search {
            flex: 1;
            max-width: 400px;
            margin: 0 30px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'IBM Plex Mono', monospace;
            transition: var(--transition-smooth);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .header-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        /* Sidebar */
        .sidebar {
            position: absolute;
            top: 70px;
            left: 0;
            bottom: 0;
            width: 320px;
            background: var(--bg-secondary);
            border-right: 2px solid var(--border-color);
            overflow-y: auto;
            z-index: 50;
        }

        .sidebar-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }

        .channel-list {
            list-style: none;
        }

        .channel-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: var(--bg-tertiary);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .channel-item:hover {
            border-color: var(--accent-primary);
            transform: translateX(5px);
        }

        .channel-item.active {
            background: linear-gradient(135deg, rgba(0, 240, 255, 0.1), rgba(0, 128, 255, 0.1));
            border-color: var(--accent-primary);
        }

        .channel-logo {
            width: 40px;
            height: 40px;
            border-radius: 6px;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--accent-primary);
        }

        .channel-info {
            flex: 1;
        }

        .channel-name {
            font-weight: 500;
            margin-bottom: 2px;
            font-size: 0.9rem;
        }

        .channel-category {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition-smooth);
        }

        .favorite-btn.active {
            color: var(--accent-secondary);
        }

        /* Video Player */
        .player-container {
            position: absolute;
            top: 70px;
            left: 320px;
            right: 0;
            bottom: 0;
            background: #000;
            display: flex;
            flex-direction: column;
        }

        .video-wrapper {
            flex: 1;
            position: relative;
            background: #000;
        }

        #videoPlayer {
            width: 100%;
            height: 100%;
            background: #000;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, transparent 20%, transparent 80%, rgba(0,0,0,0.9) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .video-wrapper:hover .video-overlay {
            opacity: 1;
        }

        .video-info {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
        }

        .video-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }

        .video-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            pointer-events: all;
        }

        .control-bar {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .control-btn {
            background: rgba(19, 24, 37, 0.8);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 10px 15px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-smooth);
            font-size: 1rem;
        }

        .control-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-primary);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 100px;
        }

        /* EPG Panel */
        .epg-panel {
            height: 250px;
            background: var(--bg-secondary);
            border-top: 2px solid var(--border-color);
            overflow-y: auto;
            padding: 20px;
        }

        .epg-header {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--accent-primary);
        }

        .epg-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid transparent;
            transition: var(--transition-smooth);
        }

        .epg-item.now-playing {
            border-left-color: var(--accent-primary);
            background: linear-gradient(90deg, rgba(0, 240, 255, 0.1), var(--bg-tertiary));
        }

        .epg-time {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 5px;
        }

        .epg-title {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .epg-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Loading Spinner */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            /* Login/Welcome screens - better mobile sizing */
            .welcome-container,
            .login-container {
                padding: 30px 20px;
                width: 95%;
                max-width: none;
            }
            
            .login-logo {
                font-size: 2rem;
            }
            
            .login-subtitle {
                font-size: 0.85rem;
            }
            
            .form-input {
                font-size: 16px; /* Prevents zoom on iOS */
            }
            
            /* Header adjustments */
            .header {
                height: 60px;
                padding: 0 15px;
            }
            
            .header-logo {
                font-size: 1.2rem;
            }
            
            .header-search {
                display: none; /* Hide search on mobile */
            }
            
            .header-controls {
                gap: 8px;
            }
            
            .header-btn {
                padding: 6px 12px;
                font-size: 0.75rem;
            }
            
            /* Sidebar - slide in from left */
            .sidebar {
                width: 100%;
                max-width: 320px;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 200;
                top: 60px; /* Adjusted for mobile header */
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
            }
            
            /* Player container - full width on mobile */
            .player-container {
                left: 0;
                top: 60px; /* Adjusted for mobile header */
            }
            
            /* Video wrapper - better aspect ratio */
            .video-wrapper {
                min-height: 250px;
            }
            
            .video-title {
                font-size: 1.2rem;
            }
            
            .video-subtitle {
                font-size: 0.8rem;
            }
            
            /* EPG panel - shorter on mobile */
            .epg-panel {
                height: 180px;
                padding: 15px;
            }
            
            .epg-header {
                font-size: 0.95rem;
                margin-bottom: 10px;
            }
            
            .epg-item {
                padding: 10px;
            }
            
            /* Channel items - better touch targets */
            .channel-item {
                padding: 15px 12px;
                margin-bottom: 10px;
            }
            
            .channel-logo {
                width: 45px;
                height: 45px;
            }
            
            .channel-name {
                font-size: 0.9rem;
            }
            
            .channel-category {
                font-size: 0.7rem;
            }
            
            .favorite-btn {
                font-size: 1.4rem;
                padding: 5px;
            }
            
            /* Sidebar sections */
            .sidebar-section {
                padding: 15px;
            }
            
            .section-title {
                font-size: 0.85rem;
            }
            
            /* Saved playlist card */
            .saved-playlist {
                padding: 15px;
            }
            
            .saved-icon {
                width: 45px;
                height: 45px;
            }
            
            .saved-info h3 {
                font-size: 1rem;
            }
            
            .saved-actions {
                flex-direction: column;
            }
            
            .btn-primary,
            .btn-secondary,
            .btn-danger {
                padding: 12px;
                font-size: 0.85rem;
            }
            
            /* Tab selector */
            .tab-btn {
                font-size: 0.8rem;
                padding: 10px 8px;
            }
            
            /* Back button */
            .back-btn {
                top: 15px;
                left: 15px;
                font-size: 0.8rem;
            }
        }
        
        /* Small phones */
        @media (max-width: 480px) {
            .login-logo {
                font-size: 1.8rem;
            }
            
            .header {
                height: 55px;
                padding: 0 10px;
            }
            
            .header-logo {
                font-size: 1rem;
            }
            
            .header-btn {
                padding: 5px 10px;
                font-size: 0.7rem;
            }
            
            .sidebar {
                max-width: 280px;
                top: 55px;
            }
            
            .player-container {
                top: 55px;
            }
            
            .video-wrapper {
                min-height: 220px;
            }
            
            .video-title {
                font-size: 1rem;
            }
            
            .video-info {
                padding: 15px;
            }
            
            .epg-panel {
                height: 150px;
                padding: 10px;
            }
            
            .channel-logo {
                width: 40px;
                height: 40px;
            }
            
            .saved-icon {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
        }
        
        /* Landscape phones */
        @media (max-width: 768px) and (orientation: landscape) {
            .video-wrapper {
                min-height: 100%;
            }
            
            .epg-panel {
                display: none; /* Hide EPG in landscape for more video space */
            }
        }
        
        /* Add mobile menu toggle button */
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
                position: fixed;
                bottom: 20px;
                left: 20px;
                width: 60px;
                height: 60px;
                background: var(--accent-gradient);
                border: none;
                border-radius: 50%;
                color: white;
                font-size: 1.5rem;
                cursor: pointer;
                box-shadow: 0 4px 20px rgba(0, 240, 255, 0.4);
                z-index: 150;
                transition: var(--transition-smooth);
            }
            
            .mobile-menu-toggle:active {
                transform: scale(0.95);
            }
            
            /* Hide when sidebar is open */
            .sidebar.mobile-open ~ .mobile-menu-toggle {
                opacity: 0.5;
            }
            
            /* Overlay when sidebar is open */
            .mobile-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.7);
                z-index: 150;
            }
            
            .mobile-overlay.active {
                display: block;
            }
        }
        
        /* Desktop - hide mobile elements */
        @media (min-width: 769px) {
            .mobile-menu-toggle {
                display: none;
            }
            
            .mobile-overlay {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Welcome Screen (Shows saved playlist option) -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-container">
            <h1 class="login-logo">STREAMVAULT</h1>
            <p class="login-subtitle">Advanced IPTV Player System</p>

            <div id="savedPlaylistSection" style="display: none;">
                <!-- Saved playlist will be inserted here -->
            </div>

            <div class="divider">OR</div>

            <button class="btn-primary" onclick="showLoginScreen()" style="width: 100%;">
                ‚ûï Add New Playlist
            </button>
        </div>
    </div>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <button class="back-btn" onclick="showWelcomeScreen()">‚Üê Back</button>
            
            <h1 class="login-logo">STREAMVAULT</h1>
            <p class="login-subtitle">Connect Your IPTV Service</p>

            <div class="tab-selector">
                <button class="tab-btn active" onclick="switchLoginTab('xtreme')">Xtreme Codes</button>
                <button class="tab-btn" onclick="switchLoginTab('m3u')">M3U Playlist</button>
            </div>

            <!-- Xtreme Codes Login -->
            <form class="login-form active" id="xtremeForm" onsubmit="loginXtreme(event)">
                <div class="form-group">
                    <label class="form-label">Server URL</label>
                    <input type="text" class="form-input" id="xtremeServer" placeholder="http://example.com:8080" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="xtremeUsername" placeholder="Your username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="xtremePassword" placeholder="Your password" required>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="rememberXtreme" checked>
                    <label for="rememberXtreme">Remember my credentials</label>
                </div>
                <button type="submit" class="login-btn">Connect</button>
            </form>

            <!-- M3U Playlist Login -->
            <form class="login-form" id="m3uForm" onsubmit="loginM3U(event)">
                <div class="form-group">
                    <label class="form-label">M3U Playlist URL</label>
                    <input type="url" class="form-input" id="m3uUrl" placeholder="http://example.com/playlist.m3u" required>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="rememberM3U" checked>
                    <label for="rememberM3U">Remember my playlist</label>
                </div>
                <button type="submit" class="login-btn">Load Playlist</button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>
        
        <!-- Header -->
        <header class="header">
            <div class="header-logo">STREAMVAULT</div>
            <div class="header-search">
                <input type="text" class="search-input" id="searchInput" placeholder="Search channels..." onkeyup="searchChannels()">
            </div>
            <div class="header-controls">
                <button class="header-btn" onclick="toggleFavorites()">‚≠ê Favorites</button>
                <button class="header-btn" onclick="logout()">Logout</button>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <h3 class="section-title">Categories</h3>
                <ul class="channel-list" id="categoryList"></ul>
            </div>
            <div class="sidebar-section">
                <h3 class="section-title">Channels</h3>
                <ul class="channel-list" id="channelList"></ul>
            </div>
        </aside>

        <!-- Player Container -->
        <div class="player-container">
            <div class="video-wrapper">
                <video id="videoPlayer" controls></video>
                
                <div class="video-overlay">
                    <div class="video-info">
                        <div class="video-title" id="currentChannelName">Select a channel</div>
                        <div class="video-subtitle" id="currentProgramInfo">No program info available</div>
                    </div>
                </div>

                <div class="loading" id="loadingSpinner">
                    <div class="spinner"></div>
                </div>
            </div>

            <!-- EPG Panel -->
            <div class="epg-panel" id="epgPanel">
                <h3 class="epg-header">üì∫ Program Guide</h3>
                <div id="epgContent">
                    <p style="color: var(--text-secondary); text-align: center; padding: 20px;">
                        Select a channel to view program guide
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" onclick="toggleMobileMenu()">
            ‚ò∞
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        // Global State
        let appState = {
            loginType: 'xtreme',
            credentials: null,
            channels: [],
            categories: [],
            favorites: JSON.parse(localStorage.getItem('favorites') || '[]'),
            currentChannel: null,
            epgData: {},
            hls: null
        };

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            checkSavedCredentials();
        });

        // Check for saved credentials
        function checkSavedCredentials() {
            const savedCreds = localStorage.getItem('iptvCredentials');
            
            if (savedCreds) {
                const creds = JSON.parse(savedCreds);
                displaySavedPlaylist(creds);
            }
        }

        // Display saved playlist option
        function displaySavedPlaylist(creds) {
            const section = document.getElementById('savedPlaylistSection');
            section.style.display = 'block';
            
            const displayName = creds.type === 'xtreme' 
                ? creds.username || 'Xtreme Codes' 
                : 'M3U Playlist';
            
            const displayDetail = creds.type === 'xtreme'
                ? creds.server || ''
                : creds.url ? new URL(creds.url).hostname : '';
            
            section.innerHTML = `
                <div class="saved-playlist">
                    <div class="saved-playlist-header">
                        <div class="saved-icon">üì∫</div>
                        <div class="saved-info">
                            <h3>${displayName}</h3>
                            <p>${displayDetail}</p>
                        </div>
                    </div>
                    <div class="saved-actions">
                        <button class="btn-primary" onclick="loadSavedPlaylist()">
                            ‚ñ∂Ô∏è Continue Watching
                        </button>
                        <button class="btn-danger" onclick="clearSavedPlaylist()">
                            üóëÔ∏è Remove
                        </button>
                    </div>
                </div>
            `;
        }

        // Load saved playlist
        function loadSavedPlaylist() {
            const savedCreds = localStorage.getItem('iptvCredentials');
            if (savedCreds) {
                const creds = JSON.parse(savedCreds);
                appState.credentials = creds;
                
                showLoading();
                
                if (creds.type === 'xtreme') {
                    loadXtremeChannels(creds.server, creds.username, creds.password);
                } else {
                    loadM3UPlaylist(creds.url);
                }
            }
        }

        // Clear saved playlist
        function clearSavedPlaylist() {
            if (confirm('Are you sure you want to remove this saved playlist?')) {
                localStorage.removeItem('iptvCredentials');
                document.getElementById('savedPlaylistSection').style.display = 'none';
            }
        }

        // Show login screen
        function showLoginScreen() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.add('active');
        }

        // Show welcome screen
        function showWelcomeScreen() {
            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('welcomeScreen').classList.remove('hidden');
        }

        // Login Tab Switching
        function switchLoginTab(type) {
            appState.loginType = type;
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(form => form.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(type === 'xtreme' ? 'xtremeForm' : 'm3uForm').classList.add('active');
        }

        // Xtreme Codes Login
        async function loginXtreme(event) {
            event.preventDefault();
            
            const server = document.getElementById('xtremeServer').value.trim();
            const username = document.getElementById('xtremeUsername').value.trim();
            const password = document.getElementById('xtremePassword').value.trim();
            const remember = document.getElementById('rememberXtreme').checked;

            appState.credentials = { server, username, password, type: 'xtreme' };
            
            if (remember) {
                localStorage.setItem('iptvCredentials', JSON.stringify(appState.credentials));
            }
            
            showLoading();
            await loadXtremeChannels(server, username, password);
        }

        // Load Xtreme Codes channels
        async function loadXtremeChannels(server, username, password) {
            try {
                const liveUrl = `${server}/player_api.php?username=${username}&password=${password}&action=get_live_streams`;
                const response = await fetch(liveUrl);
                const data = await response.json();
                
                if (data && Array.isArray(data)) {
                    console.log('=== RAW API RESPONSE ===');
                    console.log('First channel from API:', data[0]);
                    
                    appState.channels = data.map(channel => ({
                        id: channel.stream_id,
                        name: channel.name,
                        // Keep ALL category-related fields
                        category_id: channel.category_id,
                        category: channel.category_id,
                        category_name: channel.category_name,
                        categoryName: channel.category_name || 'Uncategorized',
                        logo: channel.stream_icon || '',
                        url: `${server}/live/${username}/${password}/${channel.stream_id}.m3u8`,
                        epgChannelId: channel.epg_channel_id || null
                    }));
                    
                    extractCategories();
                    initializeApp();
                } else {
                    alert('Invalid credentials or no channels available');
                    hideLoading();
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Failed to connect. Please check your credentials and try again.');
                hideLoading();
            }
        }

        // M3U Playlist Login
        async function loginM3U(event) {
            event.preventDefault();
            
            const m3uUrl = document.getElementById('m3uUrl').value.trim();
            const remember = document.getElementById('rememberM3U').checked;
            
            appState.credentials = { url: m3uUrl, type: 'm3u' };
            
            if (remember) {
                localStorage.setItem('iptvCredentials', JSON.stringify(appState.credentials));
            }
            
            showLoading();
            await loadM3UPlaylist(m3uUrl);
        }

        // Load M3U Playlist
        async function loadM3UPlaylist(m3uUrl) {
            try {
                const response = await fetch(m3uUrl);
                const m3uText = await response.text();
                
                appState.channels = parseM3U(m3uText);
                
                if (appState.channels.length > 0) {
                    extractCategories();
                    initializeApp();
                } else {
                    alert('No channels found in playlist');
                    hideLoading();
                }
            } catch (error) {
                console.error('M3U load error:', error);
                alert('Failed to load playlist. Please check the URL and try again.');
                hideLoading();
            }
        }

        // Parse M3U Playlist
        function parseM3U(m3uText) {
            const lines = m3uText.split('\n');
            const channels = [];
            let currentChannel = null;
            
            lines.forEach(line => {
                line = line.trim();
                
                if (line.startsWith('#EXTINF:')) {
                    const nameMatch = line.match(/,(.+)$/);
                    const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                    const groupMatch = line.match(/group-title="([^"]+)"/);
                    
                    currentChannel = {
                        id: Date.now() + Math.random(),
                        name: nameMatch ? nameMatch[1].trim() : 'Unknown Channel',
                        logo: logoMatch ? logoMatch[1] : '',
                        categoryName: groupMatch ? groupMatch[1] : 'Uncategorized',
                        category: groupMatch ? groupMatch[1] : 'Uncategorized'
                    };
                } else if (line && !line.startsWith('#') && currentChannel) {
                    currentChannel.url = line;
                    channels.push(currentChannel);
                    currentChannel = null;
                }
            });
            
            return channels;
        }

        // Extract categories from channels
        function extractCategories() {
            const categoryMap = new Map();
            
            // Debug: log first few channels to see structure
            console.log('=== EXTRACTING CATEGORIES ===');
            console.log('Total channels:', appState.channels.length);
            console.log('First 5 channels:', appState.channels.slice(0, 5));
            
            appState.channels.forEach((channel, index) => {
                const catKey = channel.category_id || channel.category || channel.categoryName || 'Uncategorized';
                const catName = channel.category_name || channel.categoryName || 'Uncategorized';
                
                // Debug first few
                if (index < 5) {
                    console.log(`Channel ${index}:`, {
                        name: channel.name,
                        category_id: channel.category_id,
                        category: channel.category,
                        category_name: channel.category_name,
                        categoryName: channel.categoryName,
                        computed_key: catKey,
                        computed_name: catName
                    });
                }
                
                if (!categoryMap.has(catKey)) {
                    categoryMap.set(catKey, {
                        id: catKey,
                        name: catName
                    });
                }
            });
            
            appState.categories = Array.from(categoryMap.values());
            console.log('Extracted categories:', appState.categories);
        }

        // Initialize App
        function initializeApp() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('active');
            
            setTimeout(() => {
                document.getElementById('appContainer').classList.add('active');
                renderCategories();
                renderChannels();
                hideLoading();
            }, 300);
        }

        // Render Categories
        function renderCategories() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            console.log('=== RENDERING CATEGORIES ===');
            console.log('Total categories:', appState.categories.length);
            
            // Add "All Channels" option
            const allItem = document.createElement('li');
            allItem.className = 'channel-item active';
            allItem.innerHTML = `
                <div class="channel-logo">ALL</div>
                <div class="channel-info">
                    <div class="channel-name">All Channels</div>
                    <div class="channel-category">${appState.channels.length} channels</div>
                </div>
            `;
            allItem.onclick = () => {
                document.querySelectorAll('#categoryList .channel-item').forEach(el => el.classList.remove('active'));
                allItem.classList.add('active');
                renderChannels(null);
            };
            categoryList.appendChild(allItem);
            
            // Add categories
            appState.categories.forEach(category => {
                const item = document.createElement('li');
                item.className = 'channel-item';
                
                // Count channels with comprehensive field checking
                const filterStr = String(category.id);
                const channelCount = appState.channels.filter(ch => {
                    return String(ch.category_id) === filterStr ||
                           String(ch.category) === filterStr ||
                           String(ch.category_name) === filterStr ||
                           String(ch.categoryName) === filterStr;
                }).length;
                
                console.log(`Category "${category.name}" (ID: ${category.id}): ${channelCount} channels`);
                
                item.innerHTML = `
                    <div class="channel-logo">${category.name.substring(0, 2).toUpperCase()}</div>
                    <div class="channel-info">
                        <div class="channel-name">${category.name}</div>
                        <div class="channel-category">${channelCount} channels</div>
                    </div>
                `;
                
                // Store the category ID for filtering
                item.onclick = () => {
                    console.log('Clicked category:', category.name, 'with ID:', category.id);
                    document.querySelectorAll('#categoryList .channel-item').forEach(el => el.classList.remove('active'));
                    item.classList.add('active');
                    renderChannels(category.id);
                };
                
                categoryList.appendChild(item);
            });
        }

        // Render Channels
        function renderChannels(categoryFilter = null) {
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';
            
            let filteredChannels = appState.channels;
            
            if (categoryFilter !== null) {
                console.log('=== FILTERING CHANNELS ===');
                console.log('Filter value:', categoryFilter);
                console.log('Filter type:', typeof categoryFilter);
                
                // Convert to string for comparison
                const filterStr = String(categoryFilter);
                
                filteredChannels = appState.channels.filter(ch => {
                    // Check ALL possible category fields
                    const match1 = String(ch.category_id) === filterStr;
                    const match2 = String(ch.category) === filterStr;
                    const match3 = String(ch.category_name) === filterStr;
                    const match4 = String(ch.categoryName) === filterStr;
                    
                    const matches = match1 || match2 || match3 || match4;
                    
                    // Debug first match
                    if (matches) {
                        console.log('Matched channel:', {
                            name: ch.name,
                            category_id: ch.category_id,
                            category: ch.category,
                            category_name: ch.category_name,
                            categoryName: ch.categoryName
                        });
                    }
                    
                    return matches;
                });
                
                console.log(`Found ${filteredChannels.length} channels for filter "${filterStr}"`);
            }
            
            if (filteredChannels.length === 0) {
                channelList.innerHTML = '<li style="padding: 20px; color: var(--text-secondary); text-align: center;">No channels in this category</li>';
                return;
            }
            
            filteredChannels.forEach(channel => {
                const item = document.createElement('li');
                item.className = 'channel-item';
                
                const isFavorite = appState.favorites.includes(channel.id);
                
                item.innerHTML = `
                    <div class="channel-logo">${channel.logo ? `<img src="${channel.logo}" style="width:100%;height:100%;border-radius:6px;object-fit:cover;">` : channel.name.substring(0, 2).toUpperCase()}</div>
                    <div class="channel-info">
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-category">${channel.categoryName}</div>
                    </div>
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite(event, '${channel.id}')">
                        ${isFavorite ? '‚òÖ' : '‚òÜ'}
                    </button>
                `;
                
                item.onclick = (e) => {
                    if (!e.target.classList.contains('favorite-btn')) {
                        playChannel(channel);
                    }
                };
                
                channelList.appendChild(item);
            });
        }

        // Play Channel
        function playChannel(channel) {
            appState.currentChannel = channel;
            
            document.querySelectorAll('#channelList .channel-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            document.getElementById('currentChannelName').textContent = channel.name;
            document.getElementById('currentProgramInfo').textContent = channel.categoryName;
            
            showLoading();
            
            const video = document.getElementById('videoPlayer');
            
            // Destroy existing HLS instance
            if (appState.hls) {
                appState.hls.destroy();
            }
            
            // Check if HLS is supported
            if (channel.url.includes('.m3u8')) {
                if (Hls.isSupported()) {
                    appState.hls = new Hls({
                        enableWorker: true,
                        lowLatencyMode: true
                    });
                    appState.hls.loadSource(channel.url);
                    appState.hls.attachMedia(video);
                    
                    appState.hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        video.play();
                        hideLoading();
                    });
                    
                    appState.hls.on(Hls.Events.ERROR, (event, data) => {
                        console.error('HLS error:', data);
                        if (data.fatal) {
                            hideLoading();
                            alert('Failed to load channel stream');
                        }
                    });
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = channel.url;
                    video.addEventListener('loadedmetadata', () => {
                        video.play();
                        hideLoading();
                    });
                }
            } else {
                video.src = channel.url;
                video.addEventListener('loadedmetadata', () => {
                    video.play();
                    hideLoading();
                });
            }
            
            loadEPGForChannel(channel);
            
            // Close mobile menu on mobile devices
            if (window.innerWidth <= 768) {
                closeMobileMenu();
            }
        }

        // Load EPG for Channel
        function loadEPGForChannel(channel) {
            const epgContent = document.getElementById('epgContent');
            
            // Mock EPG data
            const mockEPG = [
                {
                    time: '20:00 - 21:00',
                    title: 'Evening News',
                    description: 'Latest news and updates from around the world',
                    nowPlaying: true
                },
                {
                    time: '21:00 - 22:30',
                    title: 'Prime Time Show',
                    description: 'Tonight\'s featured entertainment program',
                    nowPlaying: false
                },
                {
                    time: '22:30 - 23:00',
                    title: 'Late Night Talk Show',
                    description: 'Interviews and comedy sketches',
                    nowPlaying: false
                }
            ];
            
            epgContent.innerHTML = mockEPG.map(program => `
                <div class="epg-item ${program.nowPlaying ? 'now-playing' : ''}">
                    <div class="epg-time">${program.time}</div>
                    <div class="epg-title">${program.title}</div>
                    <div class="epg-description">${program.description}</div>
                </div>
            `).join('');
        }

        // Search Channels
        function searchChannels() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const channelItems = document.querySelectorAll('#channelList .channel-item');
            
            channelItems.forEach(item => {
                const channelName = item.querySelector('.channel-name').textContent.toLowerCase();
                if (channelName.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Toggle Favorite
        function toggleFavorite(event, channelId) {
            event.stopPropagation();
            
            // Convert to string for comparison
            channelId = String(channelId);
            const stringFavorites = appState.favorites.map(String);
            const index = stringFavorites.indexOf(channelId);
            
            if (index > -1) {
                appState.favorites.splice(index, 1);
            } else {
                appState.favorites.push(channelId);
            }
            
            localStorage.setItem('favorites', JSON.stringify(appState.favorites));
            renderChannels();
        }

        // Toggle Favorites View
        function toggleFavorites() {
            const favoriteChannels = appState.channels.filter(ch => 
                appState.favorites.map(String).includes(String(ch.id))
            );
            
            if (favoriteChannels.length === 0) {
                alert('No favorite channels yet. Add some by clicking the star icon!');
                return;
            }
            
            const channelList = document.getElementById('channelList');
            channelList.innerHTML = '';
            
            favoriteChannels.forEach(channel => {
                const item = document.createElement('li');
                item.className = 'channel-item';
                
                item.innerHTML = `
                    <div class="channel-logo">${channel.logo ? `<img src="${channel.logo}" style="width:100%;height:100%;border-radius:6px;object-fit:cover;">` : channel.name.substring(0, 2).toUpperCase()}</div>
                    <div class="channel-info">
                        <div class="channel-name">${channel.name}</div>
                        <div class="channel-category">${channel.categoryName}</div>
                    </div>
                    <button class="favorite-btn active" onclick="toggleFavorite(event, '${channel.id}')">‚òÖ</button>
                `;
                
                item.onclick = (e) => {
                    if (!e.target.classList.contains('favorite-btn')) {
                        playChannel(channel);
                    }
                };
                
                channelList.appendChild(item);
            });
        }

        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                if (appState.hls) {
                    appState.hls.destroy();
                }
                
                appState = {
                    loginType: 'xtreme',
                    credentials: null,
                    channels: [],
                    categories: [],
                    favorites: JSON.parse(localStorage.getItem('favorites') || '[]'),
                    currentChannel: null,
                    epgData: {},
                    hls: null
                };
                
                document.getElementById('appContainer').classList.remove('active');
                setTimeout(() => {
                    showWelcomeScreen();
                }, 300);
            }
        }

        // Loading Functions
        function showLoading() {
            document.getElementById('loadingSpinner').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingSpinner').classList.remove('active');
        }

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            const isOpen = sidebar.classList.contains('mobile-open');
            
            if (isOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }

        function openMobileMenu() {
            document.getElementById('sidebar').classList.add('mobile-open');
            document.getElementById('mobileOverlay').classList.add('active');
            document.getElementById('mobileMenuToggle').textContent = '‚úï';
        }

        function closeMobileMenu() {
            document.getElementById('sidebar').classList.remove('mobile-open');
            document.getElementById('mobileOverlay').classList.remove('active');
            document.getElementById('mobileMenuToggle').textContent = '‚ò∞';
        }
    </script>
</body>
</html>
